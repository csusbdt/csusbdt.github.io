<html>
<head>
<title>Home</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<style>
#g_content {
  display: flow;
  flex-direction: column;
  align-items: stretch;
}
#g_inputs {
  display: grid;
  grid-gap: 10px;
  grid-template-columns: [label] auto [input] 1fr;        
}
input {
  grid-column: input;
  align-self: center;
}
label {
  grid-column: label;
  align-self: center;
}
td {
    width: 50%;
}
</style>
</head>
<body>

<div id="g_content">
<table>
    <tr><td>local time</td><td id="g_local_time"></td></tr>
    <tr><td>time_zone_offset</td><td><input id="g_time_zone_offset"></input></td></tr>
    <tr><td>latitude </td><td><input id="g_lat"  value="34.1083"   ></input></td></tr>
    <tr><td>longitude</td><td><input id="g_long" value="-117.2898" ></input></td></tr>
    <tr><td>sunrise</td><td id="g_sunrise"></td></tr>
    <tr><td>sunset</td><td id="g_sunset"></td></tr>
    <tr><td>light</td><td id="g_light"></td></tr>
    <tr><td>dark</td><td id="g_dark"></td></tr>
</table>

<script src="suncalc.js" type="module"></script> <!-- https://github.com/mourner/suncalc -->

<script type="module">
  function update() {
    const local_time = new Date();
    g_time_zone_offset.value = local_time.getTimezoneOffset() / 60;
    //const gmt        = new Date(local_time.toGMTString());
    const lat        = parseInt(g_lat.value);
    const long       = parseInt(g_long.value);
    const sun        = SunCalc.getTimes(local_time, lat, long);
    g_local_time.innerHTML = local_time;
    g_sunrise.innerHTML    = sun.sunrise.getHours() + ':' + sun.sunrise.getMinutes() + ' am';
    g_sunset.innerHTML     = (sun.sunset.getHours() - 12) + ':' + sun.sunset.getMinutes() + ' pm';

    const hrs24      = 24 * 60 * 60 * 1000;
    const sunrise    = sun.sunrise.getTime();
    const sunset     = sun.sunset.getTime();
    const now        = local_time.getTime();
    const yesterday  = now - hrs24;

    if (now < sunrise) {
      g_light.innerHTML = "";
      const yesterday_sunset = SunCalc.getTimes(now - hrs24, lat, long).sunset.getTime();
      g_dark.innerHTML = Math.floor((now - yesterday_sunset) / (sunrise - yesterday_sunset) * 100);        
    } else if (now < sunset) {
      g_dark.innerHTML = "";
      g_light.innerHTML = Math.floor((now - sunrise) / (sunset - sunrise) * 100);        
    } else {
      g_light.innerHTML = "";
      const tomorrow_sunrise = SunCalc.getTimes(now + hrs24, lat, long).sunrise.getTime();
      g_dark.innerHTML = Math.floor((now - sunset) / (tomorrow_sunrise - sunset) * 100);        
    }
      
  }
  update();

  g_lat             .addEventListener('change', update);
  g_long            .addEventListener('change', update);
  g_time_zone_offset.addEventListener('change', update);
</script>
    
</body>
</html>
